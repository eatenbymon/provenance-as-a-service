# Provenance as a Service

クリエイターが自身の作品の来歴を証明し、無断利用の検出と経済的抑止を実現するためのWordPressプラグインです。

## 概要

### 開発ステータス

> ⚠️ **このプラグインは現在、初期開発およびテスト段階にあります。**
>
> このプロジェクトの初期コードベースの大部分は、GoogleのAIモデル**Gemini**の支援を受けて生成されました。現在も機能の追加やテストを継続的に実施しています。
> そのため、予期せぬ不具合が含まれている可能性や、今後のアップデートで大きな仕様変更が行われる可能性があります。本番環境でのご利用にはご注意ください。
>
> フィードバックや改善提案はいつでも歓迎します。

このプラグインは、WordPressで公開される作品（投稿に紐づくアイキャッチ画像）に対して、以下の機能を提供します。

- **署名付きマニフェストの生成**: 作品のハッシュ値や作者情報を含むJSONマニフェストを生成します。
- **クライアントサイド署名**: ユーザーのブラウザ内で安全にキーペアを生成し、マニフェストに署名します。秘密鍵はサーバーに送信されません。
- **来歴の検証**: 公開された作品ページで、マニフェストの署名が有効であるかを誰でも検証できます。

## 機能一覧

- 投稿保存時に、アイキャッチ画像のハッシュ値を含む正規化されたマニフェストを自動生成します。
- ユーザープロフィールページで、自身の公開鍵（PEM形式）を登録できます。
- 投稿編集画面に専用の管理ボックスが追加され、以下の操作が可能です。
    - ブラウザ上でECDSA P-256のキーペアを新規生成。
    - 生成されたマニフェストに対して、ブラウザに保持している秘密鍵で署名。
    - 署名済みマニフェストをサーバーに送信し、データベースに保存。
- 投稿の公開ページに「検証バッジ」が表示され、マニフェストの署名状態（検証済み, 未署名など）が示されます。
- 「Verify Now」ボタンで、いつでもマニフェストの有効性を再検証できます。

## インストール手順

1. このプラグインのzipファイルをダウンロードします。
2. WordPress管理画面の `プラグイン > 新規追加` を開きます。
3. `プラグインのアップロード` ボタンを押し、ダウンロードしたzipファイルを選択してインストールします。
4. インストールが完了したら、`プラグインを有効化` ボタンをクリックします。

有効化すると、このプラグインが必要とするデータベーステーブルが自動的に作成されます。

## 使い方

### 1. 公開鍵の準備と登録

このプラグインは、ユーザー自身が管理するキーペアでマニフェストに署名します。キーペアは投稿編集画面で生成できますが、生成した公開鍵はユーザープロフィールに登録しておく必要があります。

1. **キーペアの生成**: 
   - `投稿 > 新規追加` または既存の投稿の編集画面を開きます。
   - 「Provenance & Signing」という管理ボックスが表示されます。
   - `Generate New Key Pair` ボタンをクリックすると、公開鍵と秘密鍵が生成され、それぞれのテキストエリアに表示されます。
2. **公開鍵の登録**:
   - 生成された「Public Key (PEM)」の内容をコピーします。
   - WordPress管理画面の `ユーザー > プロフィール` を開きます。
   - 「Provenance & Keys」セクションにある「Public Key (PEM format)」のテキストエリアに、コピーした公開鍵を貼り付けます。
   - `プロフィールを更新` ボタンを押して保存します。

**注意**: 生成された秘密鍵は非常に重要です。安全な場所に保管してください。この秘密鍵がなければ、過去の作品の所有権を証明したり、新しい作品に署名したりすることができなくなります。

### 2. マニフェストへの署名と提出

1. 署名したい作品の投稿編集画面を開きます。
2. アイキャッチ画像が設定されていることを確認します。投稿を保存すると、アイキャッチ画像に基づいて「Canonical Manifest to Sign」が自動的に生成・表示されます。
3. 「Provenance & Signing」ボックスの `Private Key (PEM)` テキストエリアに、ご自身の秘密鍵を貼り付けます。（または、キーペアを新規生成します）
4. `Sign Manifest` ボタンをクリックします。すると、「Generated Signature (Base64)」に署名データが生成されます。
5. `Submit Signature` ボタンをクリックします。これにより、署名済みマニフェストがサーバーに送信され、データベースに保存されます。

### 3. 署名の検証

- 投稿の公開ページにアクセスすると、コンテンツの末尾に検証バッジが表示されます。
- `Verify Now` ボタンをクリックすると、サーバーに保存されているマニフェストと署名の有効性が再度検証され、結果が表示されます。

## 今後の開発予定

- カナリア（透かし情報）の埋め込みと自動検出機能
- 作品の有料ダウンロード機能
- IPFSやブロックチェーンへのオンチェーンアンカー機能